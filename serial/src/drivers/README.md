currently this code has resource unavailable error and old code gets stuck when trying to read for unknown reason. 
